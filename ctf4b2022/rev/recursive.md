# Recursice:127 team solved

競技終了後に解いたため、フラグが正しさの保証は致しません。

## Description

## SOLUTIONS

デコンパイラGhidraを使って配布された実行ファイルを見ました。
main関数を見ると以下のようになってました。一部変数を書き換えております。

```c
undefined8 main(void){
  int iVar1;
  size_t sVar2;
  undefined8 uVar3;
  long in_FS_OFFSET;
  char flag [72];
  long local_10;
  
  local_10 = *(long *)(in_FS_OFFSET + 0x28);
  show_description();
  printf("FLAG: ");
  __isoc99_scanf("%39s%*[^\n]",flag);
  sVar2 = strlen(flag);
  if (sVar2 == 0x26) {
    iVar1 = check(flag,0);
    if (iVar1 == 1) {
      puts("Incorrect.");
      uVar3 = 1;
    }
    else {
      puts("Correct!");
      uVar3 = 0;
    }
  }
  else {
    puts("Incorrect.");
    uVar3 = 1;
  }
  if (local_10 != *(long *)(in_FS_OFFSET + 0x28)) {
                    /* WARNING: Subroutine does not return */
    __stack_chk_fail();
  }
  return uVar3;
}
```

入力された文字列の長さが`0x26`のとき、`check(flag, 0)`を呼び出していることがわかります。
`check`関数を見ると文字列を2分割し、`check(buf,param_2)`と`check(buf,half_length * half_length + param_2)`を呼び出していました。
この後文字列の長さが1、かつ`table[param_2]`が`flag`と一致しているとき`1`を返しています。

というわけで、`table[param_2]`の中身がフラグになっていると思われるため、必要な処理のみを抽出します。
```c
undefined8 check(char *param_1,int param_2){
  int length;
  int half_length;
  int result;
  size_t len;
  char *buf;
  
  len = strlen(param_1);
  length = (int)len;
  if (length == 1) {
    if (table[param_2] != *param_1) {
      return 1;
    }
  }
  else {
    half_length = length / 2;
    buf = (char *)malloc((long)half_length);
    strncpy(buf,param_1,(long)half_length);
    result = check(buf,param_2);
    if (result == 1) {
      return 1;
    }
    buf = (char *)malloc((long)(length - half_length));
    strncpy(buf,param_1 + half_length,(long)(length - half_length));
    length = check(buf,half_length * half_length + param_2);
    if (length == 1) {
      return 1;
    }
  }
  return 0;
}
```

tableはデコンパイラ結果から探すと見つかったため、そのまま配列にしました。

```python
table = [
  "63", "74", "60", "2a", "66", "34", "28", "2b", "62", "63", "39", "35", "22", "2e", "38", "31",
  "62", "7b", "68", "6d", "72", "33", "63", "2f", "7d", "72", "40", "3a", "7b", "26", "3b", "35",
  "31", "34", "6f", "64", "2a", "3c", "68", "2c", "6e", "27", "64", "6d", "78", "77", "3f", "6c",
  "65", "67", "28", "79", "6f", "29", "6e", "65", "2b", "6a", "2d", "7b", "28", "60", "71", "2f",
  "72", "72", "33", "7c", "28", "24", "30", "2b", "35", "73", "2e", "7a", "7b", "5f", "6e", "63",
  "61", "75", "72", "24", "7b", "73", "31", "76", "35", "25", "21", "70", "29", "68", "21", "71",
  "27", "74", "3c", "3d", "6c", "40", "5f", "38", "68", "39", "33", "5f", "77", "6f", "63", "34",
  "6c", "64", "25", "3e", "3f", "63", "62", "61", "3c", "64", "61", "67", "78", "7c", "6c", "3c",
  "62", "2f", "79", "2c", "79", "60", "6b", "2d", "37", "7b", "3d", "3b", "7b", "26", "38", "2c",
  "38", "75", "35", "24", "6b", "6b", "63", "7d", "40", "37", "71", "40", "3c", "74", "6d", "30",
  "33", "3a", "26", "2c", "66", "31", "76", "79", "62", "27", "38", "25", "64", "79", "6c", "32",
  "28", "67", "3f", "37", "31", "37", "71", "23", "75", "3e", "66", "77", "28", "29", "76", "6f",
  "6f", "24", "36", "67", "29", "3a", "29", "5f", "63", "5f", "2b", "38", "76", "2e", "67", "62",
  "6d", "28", "25", "24", "77", "28", "3c", "68", "3a", "31", "21", "63", "27", "72", "75", "76",
  "7d", "40", "33", "60", "79", "61", "21", "72", "35", "26", "3b", "35", "7a", "5f", "6f", "67",
  "6d", "30", "61", "39", "63", "32", "33", "73", "6d", "77", "2d", "2e", "69", "23", "7c", "77",
  "7b", "38", "6b", "65", "70", "66", "76", "77", "3a", "33", "7c", "33", "66", "35", "3c", "65",
  "40", "3a", "7d", "2a", "2c", "71", "3e", "73", "67", "21", "62", "64", "6b", "72", "30", "78",
  "37", "40", "3e", "68", "2f", "35", "2a", "68", "69", "3c", "37", "34", "39", "27", "7c", "7b",
  "29", "73", "6a", "31", "3b", "30", "2c", "24", "69", "67", "26", "76", "29", "3d", "74", "30",
  "66", "6e", "6b", "7c", "30", "33", "6a", "22", "7d", "37", "72", "7b", "7d", "74", "69", "7d",
  "3f", "5f", "3c", "73", "77", "78", "6a", "75", "31", "6b", "21", "6c", "26", "64", "62", "21",
  "6a", "3a", "7d", "21", "7a", "7d", "36", "2a", "60", "31", "5f", "7b", "66", "31", "73", "40",
  "33", "64", "2c", "76", "69", "6f", "34", "35", "3c", "5f", "34", "76", "63", "5f", "76", "33",
  "3e", "68", "75", "33", "3e", "2b", "62", "79", "76", "71", "23", "23", "40", "66", "2b", "29",
  "6c", "63", "39", "31", "77", "2b", "39", "69", "37", "23", "76", "3c", "72", "3b", "72", "72",
  "24", "75", "40", "28", "61", "74", "3e", "76", "6e", "3a", "37", "62", "60", "6a", "73", "6d",
  "67", "36", "6d", "79", "7b", "2b", "39", "6d", "5f", "2d", "72", "79", "70", "70", "5f", "75",
  "35", "6e", "2a", "36", "2e", "7d", "66", "38", "70", "70", "67", "3c", "6d", "2d", "26", "71",
  "71", "35", "6b", "33", "66", "3f", "3d", "75", "31", "7d", "6d", "5f", "3f", "6e", "39", "3c",
  "7c", "65", "74", "2a", "2d", "2f", "25", "66", "67", "68", "2e", "31", "6d", "28", "40", "5f",
  "33", "76", "66", "34", "69", "28", "6e", "29", "73", "32", "6a", "76", "67", "30", "6d", "34",
]


init_flag = "A" * 0x26

def check(flag, n):
  length = len(flag)
  # convert hex string to int
  x = int(table[n], 16)
  if(length == 1):
    # ascii decode
    print(chr(x), end="")
  else:
    half_length = length // 2
    check(flag[:half_length], n)
    check(flag[half_length:], half_length ** 2 + n)

check(init_flag, 0)
```

## FLAG

```
ctf4b{r3curs1v3_c4l1_1s_4_v3ry_u53fu1}
```

## 参考

https://blog.y011d4.com/20220605-ctf4b-writeup#recursive
